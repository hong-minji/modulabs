<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ëª¨ë‘ì—° LAB ì˜¤í”¼ìŠ¤ì•„ì›Œ ì‹ ì²­</title>
  <style>
    :root{
      --bg:#F6706E;
      --wheel-shadow: rgba(0,0,0,0.15);
      --panel-bg: #fff6f6;
      --text:#222;
      --muted:#777;
      --soldout:#C5C5C5;
      --red:#FF4D4F;
      --yellow:#FFC53D;
      --blue:#40A9FF;
      --green:#73D13D;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:#fff; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .page{
      width:100%; max-width:1100px;
      display:grid; gap:20px;
      grid-template-columns: 1fr;
    }
    .header{
      text-align:center;
    }
    .title{
      font-size: clamp(28px, 5vw, 44px); font-weight:800; letter-spacing:-0.02em; margin:0 0 8px;
    }
    .subtitle{
      font-size: clamp(14px, 2.5vw, 18px); opacity:.9; margin:0;
    }

    .content{
      display:grid; gap:20px;
      grid-template-columns: 1fr;
    }
    @media(min-width:960px){
      .content{ grid-template-columns: 1.1fr .9fr; align-items:start; }
    }

    .card{
      background:var(--panel-bg);
      color:var(--text);
      border-radius:20px;
      padding:18px;
      box-shadow: 0 10px 30px var(--wheel-shadow);
    }

    .wheel-wrap{
      display:flex; flex-direction:column; align-items:center; gap:14px;
    }
    .wheel-slot{
      position:relative; width:min(90vw,520px); aspect-ratio:1;
      display:grid; place-items:center;
    }
    canvas#wheel{
      width:100%; height:100%;
      filter: drop-shadow(0 12px 22px var(--wheel-shadow));
      border-radius:50%;
      background:#fff;
    }
    .pointer{
  position:absolute; top:-48px; left:50%; transform:translateX(-50%) rotate(180deg);
  width:0; height:0;
  z-index: 10;
  border-left:48px solid transparent;
  border-right:48px solid transparent;
  border-bottom:78px solid #FF4D4F;
  filter: drop-shadow(0 8px 16px rgba(255,77,79,0.25));
    }
    .spin-btn{
      border:0; border-radius:999px; padding:16px 28px; font-size:18px; font-weight:800; letter-spacing:.02em;
      background:#111; color:#fff; cursor:pointer;
      transition: transform .05s ease, opacity .2s ease, box-shadow .2s ease;
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
    }
    .spin-btn:disabled{
      opacity:.5; cursor:not-allowed; box-shadow:none;
    }
    .spin-btn:active{ transform: translateY(1px) scale(.995); }

    .legend{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center; font-size:12px; color:var(--muted);
    }
    .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px; vertical-align:-1px; }

    .prize-card{
      display:flex; flex-direction:column; gap:12px;
    }
    .prize-row{
      display:grid; grid-template-columns: 1fr auto auto; gap:12px; align-items:center;
      background:#fff; border-radius:14px; padding:12px 14px; border:1px solid rgba(0,0,0,0.05);
    }
    .prize-meta{
      display:flex; align-items:center; gap:12px;
      min-width:0;
    }
    .badge{
      font-size:12px; font-weight:800; padding:4px 8px; border-radius:999px; color:#111;
      background:rgba(255,255,255,.6); border:1px solid rgba(0,0,0,.08);
    }
    .prize-name{
      font-weight:800; font-size:16px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .desc{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .qty{
      display:flex; align-items:center; gap:6px; font-size:13px; color:#333;
      background:#f6f6f6; padding:6px 8px; border-radius:10px;
    }
    .qty input{
      width:56px; border:1px solid #e5e5e5; border-radius:8px; padding:6px 8px; font-size:13px; text-align:center;
      background:#fff;
    }
    .toggle{
      --on:#111;
      appearance:none; width:58px; height:34px; border-radius:999px;
      background:#e7e7e7; position:relative; outline:none; cursor:pointer; transition:background .2s ease;
    }
    .toggle:checked{ background:var(--on); }
    .toggle::after{
      content:""; position:absolute; top:3px; left:3px; width:28px; height:28px; border-radius:50%; background:#fff;
      transition:left .2s ease;
    }
    .toggle:checked::after{ left:27px; }

    .sold{
      opacity:.5; filter:grayscale(.3);
    }

    /* Result modal */
    .modal{
      position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.45); padding:20px;
    }
    .modal.show{ display:grid; }
    .modal-card{
      width:min(92vw,520px); background:#fff; color:#222; border-radius:22px; padding:22px; text-align:center;
      box-shadow: 0 16px 36px rgba(0,0,0,.35);
      position:relative; overflow:hidden;
    }
    .modal-title{ font-size:22px; font-weight:800; margin:4px 0 8px; }
    .modal-prize{ font-size:28px; font-weight:900; margin:4px 0 14px; }
    .modal-btn{ margin-top:8px; border:0; background:#111; color:#fff; padding:12px 18px; border-radius:12px; font-weight:800; cursor:pointer; }
    .modal-note{ font-size:12px; color:#666; margin-top:8px; }

    /* Confetti canvas */
    #fx{
      position:fixed; inset:0; pointer-events:none;
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="header" style="display:flex; align-items:center; justify-content:center; gap:24px; flex-wrap:wrap; margin-bottom:24px;">
      <div style="width:100%; text-align:center;">
  <img src="https://github.com/hong-minji/modulabs/blob/main/logo-w-4x.png" alt="LAB Logo" style="width: 75%; background:transparent; margin-bottom:50px; margin-top:50px; display:block; margin-left:auto; margin-right:auto;" />
        <div style="display:flex; align-items:center; justify-content:center; gap:16px; flex-wrap:wrap;">
          <h1 class="title" style="color:#fff; margin:0; font-size:clamp(28px,5vw,44px); font-weight:800; letter-spacing:-0.02em;">LAB ì˜¤í”¼ìŠ¤ì•„ì›Œ ì‹ ì²­</h1>
          <img src="https://resources-public-prd.modulabs.co.kr/post/attachment/3583/d9e2f379-2f81-4a15-95eb-988a8af3eb08.png" alt="QR Code" style="height:112px; margin-left:8px; border-radius:8px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.08);" />
        </div>
      </div>
    </header>

    <div class="content">
      <!-- WHEEL -->
      <section class="card wheel-wrap">
        <div class="wheel-slot">
          <div class="pointer" aria-hidden="true"></div>
          <canvas id="wheel" width="900" height="900" aria-label="ê²½í’ˆ ë£°ë ›"></canvas>
        </div>
        <button id="spin" class="spin-btn">ğŸ¡ ì¶”ì²¨í•˜ê¸°</button>
        <div class="legend">
          <span><span class="dot" style="background:var(--red)"></span>1ë“± ìº í•‘ìš© í´ë”© ë°•ìŠ¤</span>
          <span><span class="dot" style="background:var(--yellow)"></span>2ë“± í…€ë¸”ëŸ¬</span>
          <span><span class="dot" style="background:var(--blue)"></span>3ë“± ê·€ì—¬ìš´ ë§ˆìš°ìŠ¤</span>
          <span><span class="dot" style="background:var(--green)"></span>4ë“± ê°„ì‹</span>
        </div>
      </section>

      <!-- PRIZE CONTROL -->
      <section class="card prize-card" id="controls">
    <h3 style="margin:0 0 6px; font-size:18px; font-weight:900;">ê²½í’ˆ</h3>

        <!-- Rows injected by JS -->
      </section>
    </div>
  </div>

  <!-- CONFETTI FX -->
  <canvas id="fx"></canvas>

  <!-- RESULT MODAL -->
  <div class="modal" id="resultModal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div id="sparkle"></div>
      <div style="font-size:40px; margin-bottom:8px;">ğŸ‰</div>
      <div class="modal-title">ì¶•í•˜í•©ë‹ˆë‹¤!</div>
      <div id="resultText" class="modal-prize">â€”</div>
      <button class="modal-btn" id="closeModal">í™•ì¸</button>
  <!-- ë¬¸êµ¬ ì‚­ì œë¨ -->
    </div>
  </div>

  <script>
    // ====== DATA ======
    const prizes = [
  { id: 0, rank: "1ë“±", name: "ìº í•‘ìš© í´ë”© ë°•ìŠ¤", color: getCss('--red'), desc: "ê³ ê¸‰ í´ë”© ë°•ìŠ¤", icon: "â›ºï¸", soldOut: false, baseWeight: 7 },
  { id: 1, rank: "2ë“±", name: "í…€ë¸”ëŸ¬", color: getCss('--yellow'), desc: "ë°ì¼ë¦¬ í…€ë¸”ëŸ¬", icon: "ğŸ§ƒ", soldOut: false, baseWeight: 6 },
  { id: 2, rank: "3ë“±", name: "ê·€ì—¬ìš´ ë§ˆìš°ìŠ¤", color: getCss('--blue'), desc: "ë§ˆì‹œë©œë¡œ ë§ˆìš°ìŠ¤", icon: "ğŸ–±ï¸", soldOut: false, baseWeight: 0 },
  { id: 3, rank: "4ë“±", name: "ê°„ì‹", color: getCss('--green'), desc: "ë§›ìˆëŠ” ìŠ¤ë‚µ", icon: "ğŸ¬", soldOut: false, baseWeight: 20 },
  { id: 4, rank: "5ë“±", name: "ì‹œì›í•œ ë¶€ì±„", color: "#A259FF", desc: "ì—¬ë¦„ ë°”ëŒ ë¶€ì±„", icon: "ğŸŒ¬ï¸", soldOut: false, baseWeight: 20 },
    ];
    // í—¬í¼: CSS var ì½ê¸°
    function getCss(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }

    // ====== CANVAS / WHEEL ======
    const wheel = document.getElementById('wheel');
    const ctx = wheel.getContext('2d');
    const size = wheel.width; // square
    const R = size/2;
    let rotation = 0; // degrees
    const sliceAngle = 360 / prizes.length;

    function drawWheel(){
      ctx.clearRect(0,0,size,size);
      ctx.save();
      ctx.translate(R, R);
      ctx.rotate(deg2rad(rotation));

      // segments
      for(let i=0;i<prizes.length;i++){
        const p = prizes[i];
        const start = deg2rad(i*sliceAngle - 90); // -90: 12ì‹œ ê¸°ì¤€
        const end   = deg2rad((i+1)*sliceAngle - 90);
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.arc(0,0,R-8,start,end,false);
        ctx.closePath();

        // ìƒ‰ìƒ/í’ˆì ˆ í‘œí˜„
  ctx.fillStyle = p.soldOut ? shadeColor(p.color, 60) : p.color;
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'rgba(0,0,0,0.05)';
        ctx.stroke();

        // text & icon
        const mid = (start+end)/2;
        ctx.save();
        ctx.rotate(mid);
        ctx.translate((R-80), 0);
        ctx.rotate(Math.PI/2);
        ctx.textAlign = 'center';
        // ì•„ì´ì½˜
        ctx.font = 'bold 54px system-ui';
        ctx.fillStyle = '#111';
        ctx.fillText(p.icon, 0, -12);
        // ë“±ìˆ˜/ì´ë¦„
        ctx.font = '900 28px system-ui';
        ctx.fillText(`${p.rank}`, 0, 32);
        ctx.font = '700 22px system-ui';
        ctx.fillText(`${p.name}`, 0, 62);
        // ì—†ìŒ ë¼ë²¨
        if(p.soldOut){
          ctx.font = '800 20px system-ui';
          ctx.fillStyle = '#333';
          ctx.fillText(`ì—†ìŒ`, 0, 90);
        }
        ctx.restore();
      }

      // center disk
  ctx.beginPath();
  ctx.arc(0,0,58,0,Math.PI*2);
  ctx.fillStyle = '#111';
  ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.font = '900 28px system-ui';
  ctx.textAlign = 'center';
  ctx.fillText('MODULABS', 0, -6);
  ctx.font = '700 18px system-ui';
  ctx.fillText('OFFICE HOUR', 0, 22);

      ctx.restore();
    }

    function deg2rad(d){ return d*Math.PI/180; }
    function mod(a,b){ return ((a%b)+b)%b; }
    function shadeColor(hex, percent){
      // lighten toward #C5C5C5 for sold-out
      const t = {r:197,g:197,b:197};
      const c = hexToRGB(hex);
      const r = Math.round(c.r + (t.r-c.r)*(percent/100));
      const g = Math.round(c.g + (t.g-c.g)*(percent/100));
      const b = Math.round(c.b + (t.b-c.b)*(percent/100));
      return `rgb(${r},${g},${b})`;
    }
    function hexToRGB(hex){
      let h = hex.replace('#','');
      if(h.length===3) h = h.split('').map(x=>x+x).join('');
      const n = parseInt(h,16);
      return { r:(n>>16)&255, g:(n>>8)&255, b:n&255 };
    }

    // ====== PROBABILITY / PICK ======
    function currentWeights(){
  return prizes.map(p=> p.soldOut ? 0 : p.baseWeight);
    }
    function weightedPick(){
      const w = currentWeights();
      const sum = w.reduce((a,b)=>a+b,0);
      if(sum===0) return null;
      let r = Math.random()*sum;
      for(let i=0;i<w.length;i++){
        if(r < w[i]) return i;
        r -= w[i];
      }
      return w.length-1;
    }

    // ====== SPIN / EASING / SOUND ======
    const spinBtn = document.getElementById('spin');
    let spinning = false;

    // simple tick sound via WebAudio
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function tick(){
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type='square';
      o.frequency.value = 900 + Math.random()*100;
      g.gain.value = 0.04;
      o.connect(g).connect(audioCtx.destination);
      o.start();
      setTimeout(()=>{ o.stop(); }, 35);
    }

    function spin(){
      if(spinning) return;
      const targetIndex = weightedPick();
      if(targetIndex===null){
        alert('ëª¨ë“  ê²½í’ˆì´ í’ˆì ˆì…ë‹ˆë‹¤.');
        return;
      }
      spinning = true;
      spinBtn.disabled = true;

      // ëª©í‘œ ê°ë„ ê³„ì‚°: ë‹¹ì²¨ ì„¹ì…˜ì˜ "ì¤‘ì‹¬"ì´ 12ì‹œ(0Â°)ì— ì˜¤ë„ë¡
      // í˜„ì¬ íšŒì „(rotation) ê¸°ì¤€ìœ¼ë¡œ ì„¹ì…˜ iì˜ ì¤‘ì‹¬ ê°:
      // center = rotation + i*slice + slice/2
      // ì´ ê°’ì´ 0Â°(ë˜ëŠ” 360Â°)ì´ ë˜ê²Œ í•˜ë ¤ë©´ delta = 360 - (center % 360)
      const centerNow = rotation + targetIndex*sliceAngle + sliceAngle * Math.random();
      const alignDelta = mod(360 - mod(centerNow,360), 360);

      // ì—¬ë¶„ íšŒì „(ìì—°ìŠ¤ëŸ¬ìš´ ìŠ¤í•€): 3.5 ~ 5.5ë°”í€´
      const extra = 360 * 5 ;

      const start = rotation;
      const end = rotation + extra + alignDelta; // ìµœì¢… ê°ë„

      const dur = 3400 + Math.random()*900; // 3.4~4.3ì´ˆ
      const t0 = performance.now();

      // ê°€ì†-ê°ì† ì´ì§•
      const easeOutCubic = x => 1 - Math.pow(1 - x, 3);

      // tick ë¹ˆë„ ì»¨íŠ¸ë¡¤
      let lastTickAngle = rotation;

      // ì‚¬ìš´ë“œ(ìŠ¤í•€ ì‹œì‘ íš¨ê³¼)
      tick();

      function frame(t){
        const p = Math.min(1, (t - t0) / dur);
        const eased = easeOutCubic(p);
        rotation = start + (end - start) * eased;
        drawWheel();

        // tick: ì„¹ì…˜ ê²½ê³„ í†µê³¼ ì‹œ íš¨ê³¼ìŒ
        if(Math.abs(rotation - lastTickAngle) > sliceAngle/2){
          tick();
          lastTickAngle = rotation;
        }

        if(p < 1){
          requestAnimationFrame(frame);
        }else{
          rotation = end % 360;
          drawWheel();
          setTimeout(()=> onFinish(targetIndex), 50);
        }
      }
      requestAnimationFrame(frame);
    }

    function onFinish(index){
  // ë‹¹ì²¨ ê²°ê³¼ í‘œì‹œë§Œ
  const p = prizes[index];
  showResult(`${p.rank} â€” ${p.name} ${p.icon}`);

      // ì¶•í•˜ ì´í™íŠ¸
      confetti(900);

      spinning = false;
      spinBtn.disabled = false;
    }

    // ====== CONTROLS UI ======
    const controls = document.getElementById('controls');
    function renderControls(){
      controls.querySelectorAll('.prize-row').forEach(el=>el.remove());

      prizes.forEach(p=>{
        const row = document.createElement('div');
  row.className = 'prize-row' + (p.soldOut ? ' sold' : '');
        row.style.setProperty('--outline', p.color);

        const meta = document.createElement('div');
        meta.className = 'prize-meta';

        const colorDot = document.createElement('span');
        colorDot.className = 'dot';
        colorDot.style.background = p.color;
        colorDot.style.width = '14px';
        colorDot.style.height = '14px';

        const name = document.createElement('div');
  name.innerHTML = `<div class="prize-name">${p.rank} Â· ${p.name}</div>`;

        const badge = document.createElement('span');
        badge.className = 'badge';
  badge.textContent = p.soldOut ? 'ì—†ìŒ' : 'ìˆìŒ';

        meta.append(colorDot, name, badge);

        // ìˆìŒ/ì—†ìŒ í† ê¸€
        const toggle = document.createElement('input');
        toggle.type = 'checkbox';
        toggle.checked = !p.soldOut;
        toggle.addEventListener('change', ()=>{
          p.soldOut = !toggle.checked;
          drawWheel(); renderControls();
        });
        toggle.style.marginLeft = '12px';

        row.append(meta, toggle);
        controls.appendChild(row);
      });
  // ì¤‘ë³µëœ toggle ìƒì„± ë° forEach ì¢…ë£Œ ì œê±°
    }

    // ====== RESULT MODAL ======
    const modal = document.getElementById('resultModal');
    const resultText = document.getElementById('resultText');
    const closeModal = document.getElementById('closeModal');
    function showResult(text){
      resultText.textContent = text;
      modal.classList.add('show');
    }
    closeModal.addEventListener('click', ()=> modal.classList.remove('show'));
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('show'); });

    // ====== CONFETTI (simple) ======
    const fx = document.getElementById('fx');
    const fxc = fx.getContext('2d');
    let particles = [];
    function confetti(count=600){
      resizeFx();
      particles = [];
      for(let i=0;i<count;i++){
        particles.push({
          x: Math.random()*fx.width,
          y: -10 - Math.random()*fx.height*0.3,
          r: 2 + Math.random()*3,
          vy: 2 + Math.random()*4,
          vx: (Math.random()-0.5)*2,
          a: Math.random()*Math.PI*2,
          va: (Math.random()-0.5)*0.2,
        });
      }
      if(!confetti.anim){
        confetti.anim = true;
        requestAnimationFrame(confettiFrame);
      }
    }
    function resizeFx(){
      fx.width = window.innerWidth;
      fx.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeFx);
    function confettiFrame(){
      fxc.clearRect(0,0,fx.width,fx.height);
      let alive = 0;
      particles.forEach(p=>{
        p.x += p.vx;
        p.y += p.vy;
        p.a += p.va;
        if(p.y < fx.height+10){
          alive++;
          fxc.save();
          fxc.translate(p.x,p.y);
          fxc.rotate(p.a);
          fxc.fillStyle = ['#fff','#ffd166','#06d6a0','#118ab2','#ff4d4f','#73d13d','#40a9ff'][ (alive+p.r|0) % 7 ];
          fxc.fillRect(-p.r,-p.r,p.r*2,p.r*2);
          fxc.restore();
        }
      });
      particles = particles.filter(p=>p.y < fx.height+10);
      if(particles.length>0){
        requestAnimationFrame(confettiFrame);
      }else{
        confetti.anim = false;
      }
    }

    // ====== INIT ======
    drawWheel();
    renderControls();
    document.getElementById('spin').addEventListener('click', spin);
    // ====== KEYBOARD EVENTS ======
    document.addEventListener('keydown', function(e) {
      // Spacebar triggers spin
      if (e.code === 'Space' || e.key === ' ') {
        // Only spin if modal is not open
        if (!modal.classList.contains('show')) {
          spin();
        }
      }
      // Enter closes modal
      if (e.code === 'Enter' || e.key === 'Enter') {
        if (modal.classList.contains('show')) {
          modal.classList.remove('show');
        }
      }
    });

  </script>
</body>
</html>
